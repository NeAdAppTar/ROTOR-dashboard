<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–û—Ç—á—ë—Ç—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="style_db.css">
<link rel="icon" href="icon.png">
<script src="usermenu.js"></script> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
.status-not { background:#ffd000; }
.status-ok { background:#c6f6d5; }
.status-rej { background:#fecaca; }
.actions button { margin-right:6px; }
</style>


</head>

<body>

<div class="sidebar" id="sidebar"> 
    <div class="sidebar-header">
        <span class="logo">–†–û–¢–û–†</span>
    </div>

    <ul class="sidebar-menu">
        <li><a href="employee_dashboard.html"><i class="fas fa-user"></i><span>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span></a></li>
        <li><a href="employees.html"><i class="fas fa-users"></i><span>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span></a></li>
        <li><a href="routes.html"><i class="fas fa-route"></i><span>–ú–∞—Ä—à—Ä—É—Ç—ã</span></a></li>
        <li><a href="vehicles.html"><i class="fas fa-truck"></i><span>–°–ø–∏—Å–æ–∫ –ü–°</span></a></li>
        <li><a href="submit_route.html"><i class="fas fa-file"></i><span>–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–π –ª–∏—Å—Ç</span></a></li>
        <li><a href="charter.html"><i class="fas fa-book"></i><span>–£—Å—Ç–∞–≤</span></a></li>
        <li><a href="plan.html"><i class="fas fa-calendar"></i><span>–ü–ª–∞–Ω</span></a></li>
        <li><a href="t.html"><i class="fas fa-check"></i><span>–¢–µ—Å—Ç—ã</span></a></li>
        <li><a href="binds.html"><i class="fas fa-keyboard"></i><span>–ë–∏–Ω–¥—ã –∏ —Ç–∞–±–ª–∏—á–∫–∏</span></a></li>
    </ul>

    <div class="user-menu" id="userMenu">

      <div class="user-menu-item" id="nyBtn">
        <i class="fas fa-snowflake"></i>
        <span>–ù–ì –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
      </div>
      
      <div class="user-menu-item" id="themeBtn">
          <i class="fas fa-moon"></i>
          <span>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
      </div>

      <div class="user-menu-item" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i>
          <span>–í—ã–π—Ç–∏</span>
      </div>

      <div class="user-name-display">
          <i class="fas fa-user"></i>
          <span id="userName">user</span>
      </div>

    
    </div>
</div>

<div class="main-content">
<main class="container">

<h1>–û—Ç—á—ë—Ç—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π</h1>

<div class="table-card">
<table class="styled-table">
<thead>
<tr>
<th>–§–ò–û</th>
<th>–î–∞—Ç–∞</th>
<th>–ú–∞—Ä—à—Ä—É—Ç</th>
<th>–ö—Ä—É–≥–∏</th>
<th>–ü–∞—Å—Å.</th>
<th>–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ</th>
<th>–°—Ç–∞—Ç—É—Å</th>
<th>–î–µ–π—Å—Ç–≤–∏—è</th>
</tr>
</thead>
<tbody id="reportsBody"></tbody>
</table>
</div>

</main>
</div>

<script>
  const pageAccess = ["–î–∏—Ä–µ–∫—Ç–æ—Ä", "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"];

const COMPANY = "rotor";

/* =========================
   –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á—ë—Ç–æ–≤
========================= */

async function loadReports() {
  const res = await fetch(`https://rotorbus.ru/api/reports/${COMPANY}`);
  const data = await res.json();

  reportsBody.innerHTML = "";

  data.reports.forEach(r => {
    const tr = document.createElement("tr");

    if (r.status === "verified") tr.className = "status-ok";
    if (r.status === "rejected") tr.className = "status-rej";
    if (r.status === "not_verified") tr.className = "status-not";

    let statusClass = "";
let badgeClass = "";
let statusText = "";

if (r.status === "verified") {
  statusClass = "status-ok";
  badgeClass = "badge-ok";
  statusText = "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω";
}

if (r.status === "rejected") {
  statusClass = "status-rej";
  badgeClass = "badge-rej";
  statusText = "–û—Ç–∫–ª–æ–Ω—ë–Ω";
}

if (r.status === "not_verified") {
  statusClass = "status-not";
  badgeClass = "badge-not";
  statusText = "–û–∂–∏–¥–∞–µ—Ç";
}

tr.className = statusClass;

tr.innerHTML = `
  <td>${r.user_name}</td>
  <td>${r.date}</td>
  <td>${r.route}</td>
  <td>${r.num_round_trips}</td>
  <td>${r.num_passengers}</td>
  <td>
    ${r.proof ? `<a class="proof-link" href="${r.proof}" target="_blank">üìé</a>` : ""}
  </td>
  <td>
    <span class="status-badge ${badgeClass}">
      ${statusText}
    </span>
  </td>
  <td class="actions">
    ${
      r.status === "not_verified"
        ? `
          <button class="btn-ok" onclick="verify(${r.id})">‚úî</button>
          <button class="btn-rej" onclick="reject(${r.id})">‚úñ</button>
        `
        : ""
    }
    <button class="btn-del" onclick="del(${r.id})">üóë</button>
  </td>
`;

    reportsBody.appendChild(tr);
  });
}

/* =========================
   –î–µ–π—Å—Ç–≤–∏—è
========================= */

async function verify(id) {
  await fetch(`https://rotorbus.ru/api/report/verify/${COMPANY}/${id}`, {
    method: "POST"
  });
  loadReports();
}

async function reject(id) {
  await fetch(`https://rotorbus.ru/api/report/reject/${COMPANY}/${id}`, {
    method: "POST"
  });
  loadReports();
}

async function del(id) {
  if (!confirm("–£–¥–∞–ª–∏—Ç—å –æ—Ç—á—ë—Ç?")) return;

  await fetch(`https://rotorbus.ru/api/report/${COMPANY}/${id}`, {
    method: "DELETE"
  });
  loadReports();
}

/* =========================
   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
========================= */

loadReports();
</script>

</body>
<script src="sidebar.js"></script>
<script src="checkauth.js"></script>
</html>
