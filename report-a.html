<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–û—Ç—á—ë—Ç—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π</title>

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="style_db.css">
<link rel="icon" href="icon.png">

<style>
.status-not { background:#ffd000; }
.status-ok { background:#c6f6d5; }
.status-rej { background:#fecaca; }
.actions button { margin-right:6px; }
</style>

<script src="sidebar.js"></script>
</head>

<body>

<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span class="logo">–†–û–¢–û–†</span>
  </div>

  <ul class="sidebar-menu">
    <li>
      <a href="reports_manage.html" class="active">
        <span>–û—Ç—á—ë—Ç—ã</span>
      </a>
    </li>
  </ul>
</div>

<div class="main-content">
<main class="container">

<h1>–û—Ç—á—ë—Ç—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π</h1>

<div class="table-card">
<table class="styled-table">
<thead>
<tr>
<th>–§–ò–û</th>
<th>–î–∞—Ç–∞</th>
<th>–ú–∞—Ä—à—Ä—É—Ç</th>
<th>–ö—Ä—É–≥–∏</th>
<th>–ü–∞—Å—Å.</th>
<th>–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ</th>
<th>–°—Ç–∞—Ç—É—Å</th>
<th>–î–µ–π—Å—Ç–≤–∏—è</th>
</tr>
</thead>
<tbody id="reportsBody"></tbody>
</table>
</div>

</main>
</div>

<script>
const COMPANY = "rotor";

/* =========================
   –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á—ë—Ç–æ–≤
========================= */

async function loadReports() {
  const res = await fetch(`https://rotorbus.ru/api/reports/${COMPANY}`);
  const data = await res.json();

  reportsBody.innerHTML = "";

  data.reports.forEach(r => {
    const tr = document.createElement("tr");

    if (r.status === "verified") tr.className = "status-ok";
    if (r.status === "rejected") tr.className = "status-rej";
    if (r.status === "not_verified") tr.className = "status-not";

    let statusClass = "";
let badgeClass = "";
let statusText = "";

if (r.status === "verified") {
  statusClass = "status-ok";
  badgeClass = "badge-ok";
  statusText = "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω";
}

if (r.status === "rejected") {
  statusClass = "status-rej";
  badgeClass = "badge-rej";
  statusText = "–û—Ç–∫–ª–æ–Ω—ë–Ω";
}

if (r.status === "not_verified") {
  statusClass = "status-not";
  badgeClass = "badge-not";
  statusText = "–û–∂–∏–¥–∞–µ—Ç";
}

tr.className = statusClass;

tr.innerHTML = `
  <td>${r.user_name}</td>
  <td>${r.date}</td>
  <td>${r.route}</td>
  <td>${r.num_round_trips}</td>
  <td>${r.num_passengers}</td>
  <td>
    ${r.proof ? `<a class="proof-link" href="${r.proof}" target="_blank">üìé</a>` : ""}
  </td>
  <td>
    <span class="status-badge ${badgeClass}">
      ${statusText}
    </span>
  </td>
  <td class="actions">
    ${
      r.status === "not_verified"
        ? `
          <button class="btn-ok" onclick="verify(${r.id})">‚úî</button>
          <button class="btn-rej" onclick="reject(${r.id})">‚úñ</button>
        `
        : ""
    }
    <button class="btn-del" onclick="del(${r.id})">üóë</button>
  </td>
`;

    reportsBody.appendChild(tr);
  });
}

/* =========================
   –î–µ–π—Å—Ç–≤–∏—è
========================= */

async function verify(id) {
  await fetch(`https://rotorbus.ru/api/report/verify/${COMPANY}/${id}`, {
    method: "POST"
  });
  loadReports();
}

async function reject(id) {
  await fetch(`https://rotorbus.ru/api/report/reject/${COMPANY}/${id}`, {
    method: "POST"
  });
  loadReports();
}

async function del(id) {
  if (!confirm("–£–¥–∞–ª–∏—Ç—å –æ—Ç—á—ë—Ç?")) return;

  await fetch(`https://rotorbus.ru/api/report/${COMPANY}/${id}`, {
    method: "DELETE"
  });
  loadReports();
}

/* =========================
   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
========================= */

loadReports();
</script>

</body>
</html>
