<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Фотохостинг — FileStore</title>

  <!-- ВСТАВЬ ТВОИ СТИЛИ -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* ДОПОЛНЕНИЕ: галерея */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .gallery img {
      width: 100%;
      border-radius: 14px;
      box-shadow: var(--shadow);
      transition: transform .2s ease;
      cursor: zoom-in;
    }
    .gallery img:hover {
      transform: scale(1.03);
    }

    /* fullscreen viewer */
    #viewer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #viewer img {
      max-width: 90%;
      max-height: 90%;
    }
  </style>
</head>

<body>

<!-- Навигация -->
<div class="navbar">
  <a href="#" class="active">Загрузка</a>
  <a href="#viewer-block">Просмотр</a>
</div>

<div class="dashboard">

  <!-- Загрузка файлов -->
  <div class="tile">
    <h3>Загрузка фото</h3>
    <p>Выберите изображения или архив</p>

    <form id="uploadForm" enctype="multipart/form-data" method="post" action="https://rotorbus.ru/filestore">
      <input type="file" id="fileInput" name="files" multiple />
      <br><br>
      <button type="submit">Загрузить</button>
    </form>

    <p id="uploadResult"></p>
  </div>

  <!-- Получение фото -->
  <div class="tile" id="viewer-block">
    <h3>Просмотр по ссылке</h3>
    <p>Вставьте ссылку вида<br><b>https://rotorbus.ru/filestore/26130252202624</b></p>

    <input id="loadUrl" style="padding:10px; width:100%; border-radius:10px;" placeholder="Вставьте ссылку">

    <br><br>
    <button onclick="loadImages()">Загрузить изображения</button>

    <p id="loadStatus"></p>
  </div>

</div>

<!-- Галерея -->
<div id="gallery" class="gallery"></div>

<!-- Fullscreen viewer -->
<div id="viewer" onclick="this.style.display='none'">
  <img id="viewerImg" src="">
</div>



<script>
// ---------- ЗАГРУЗКА ФАЙЛОВ ----------
document.getElementById("uploadForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const form = e.target;
    const data = new FormData(form);

    document.getElementById("uploadResult").textContent = "Загрузка...";

    try {
        let response = await fetch(form.action, {
            method: "POST",
            body: data
        });

        let json = await response.json();

        if (json.status === "ok") {
            document.getElementById("uploadResult").innerHTML =
                `✓ <b>Файлы загружены!</b><br>Ссылка: <a href="${json.url}" target="_blank">${json.url}</a>`;
        } else {
            document.getElementById("uploadResult").textContent = "Ошибка: " + JSON.stringify(json);
        }
    } catch (err) {
        document.getElementById("uploadResult").textContent = "Ошибка загрузки: " + err;
    }
});


// ---------- ПРОСМОТР ФОТО ПО ССЫЛКЕ ----------
async function loadImages() {
    let url = document.getElementById("loadUrl").value.trim();
    let gallery = document.getElementById("gallery");
    let status = document.getElementById("loadStatus");

    gallery.innerHTML = "";
    status.textContent = "Загрузка...";

    if (!url.startsWith("https://rotorbus.ru/filestore")) {
        status.textContent = "Неверная ссылка!";
        return;
    }

    try {
        // 1. Загружаем страницу содержимого
        let resp = await fetch(url);
        if (!resp.ok) throw new Error("Не удалось загрузить данные");

        let text = await resp.text();

        // 2. Пытаемся извлечь изображения из HTML (на сервере у тебя HTML-рендер)
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, "text/html");

        let imgs = [...doc.querySelectorAll("img")];

        if (imgs.length === 0) {
            status.textContent = "Изображений не найдено (возможно ZIP?).";
            return;
        }

        status.textContent = `Найдено ${imgs.length} фото`;

        imgs.forEach(img => {
            let el = document.createElement("img");
            el.src = img.src;
            el.loading = "lazy";

            el.onclick = () => showViewer(img.src);

            gallery.appendChild(el);
        });

    } catch(e) {
        status.textContent = "Ошибка: " + e.message;
    }
}


// ---------- Фуллскрин просмотр ----------
function showViewer(src) {
    document.getElementById("viewerImg").src = src;
    document.getElementById("viewer").style.display = "flex";
}
</script>

</body>
</html>