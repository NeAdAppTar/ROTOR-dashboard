<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1"> -->
  <title>ROTOR ‚Äî –ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="icon.png">
  <script src="checkauth.js"></script>
  <script src="usermenu.js"></script>
</head>

<body>

  
<div class="navbar">
  <div class="nav-links">
    <a href="employee_dashboard.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    <a href="employees.html">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a>
    <a href="routes.html">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
    <a href="vehicles.html">–°–ø–∏—Å–æ–∫ –ü–°</a>
    <a href="submit_route.html">–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–π –ª–∏—Å—Ç</a>
    <a href="charter.html">–£—Å—Ç–∞–≤</a>
    <a href="plan.html">–ü–ª–∞–Ω</a>
    <a href="t.html">–¢–µ—Å—Ç—ã</a>
    <a href="binds.html">–ë–∏–Ω–¥—ã –∏ —Ç–∞–±–ª–∏—á–∫–∏</a>
  </div>

<div class="user-menu" id="userMenu">
  <span class="user-name" id="userName">user</span>
  <div class="dropdown" id="dropdownMenu">
    <button id="logoutBtn">–í—ã–π—Ç–∏</button>
    <button id="themeBtn">üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
  </div>
</div>
</div>


  <div class="dashboard">
    <div class="tile">
      <h3>–ù–∏–∫–Ω–µ–π–º</h3>
      <p class="highlight" id="nickname">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <div class="tile">
      <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ–≥–æ</h3>
      <p>–ö—Ä—É–≥–æ—Ä–µ–π—Å–æ–≤: <span class="highlight" id="totalRoutes">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤: <span class="highlight" id="totalPassengers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>

    <div class="tile">
      <h3>–¢–µ–∫—É—â–∏–π –ø–æ–ª—É–ø–µ—Ä–∏–æ–¥</h3>
      <p>–ö—Ä—É–≥–æ—Ä–µ–π—Å–æ–≤: <span class="highlight" id="periodRoutes">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>

      <div class="progress-container">
        <div class="progress-bar" id="routesProgress"></div>
        <span class="progress-label" id="routesProgressLabel">0 / 16</span>
      </div>

      <p>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤: <span class="highlight" id="periodPassengers">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>

    <div class="tile">
      <h3>–û–∫–ª–∞–¥ –∑–∞ –ø–æ–ª—É–ø–µ—Ä–∏–æ–¥</h3>
      <p class="highlight" id="salary">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <div class="tile important">
      <p>–í–æ–¥–∏—Ç–µ–ª—å, –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–º–µ–Ω—ã –Ω–µ –∑–∞–±—ã–≤–∞–π —Å–¥–∞–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–Ω—ã–π –ª–∏—Å—Ç</p>
    </div>

   <a href="https://dashboard.rotorbus.ru/11h1" target="_blank" class="tile important" style="text-decoration: none; color: inherit;">
      <p>–í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –ø–µ—Ä–≤—ã–π –ø–æ–ª—É–ø–µ—Ä–∏–æ–¥ –Ω–æ—è–±—Ä—è (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ)</p>
    </a>

  </div>

  <script>
    function formatNumber(value) {
      if (value === null || value === undefined) return '0';
      const str = String(value).trim();
      if (str.includes('.')) {
        const [int, dec] = str.split('.');
        return dec === '0' ? int : str;
      }
      return str;
    }

    async function loadDashboard() {
  const login = localStorage.getItem('userLogin');
  const nickname = document.getElementById('nickname');
  const totalRoutes = document.getElementById('totalRoutes');
  const totalPassengers = document.getElementById('totalPassengers');
  const periodRoutes = document.getElementById('periodRoutes');
  const periodPassengers = document.getElementById('periodPassengers');
  const salary = document.getElementById('salary');

  nickname.textContent = login;

  try {
    const response = await fetch('https://rotor.pythonanywhere.com/user_info', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ login })
    });

    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');

    const data = await response.json();

    totalRoutes.textContent = formatNumber(data.all_routes);
    totalPassengers.textContent = formatNumber(data.all_passengers);
    periodRoutes.textContent = formatNumber(data.half_routes);
    periodPassengers.textContent = formatNumber(data.half_passengers);
    salary.textContent = data.salary ? formatNumber(data.salary) + ' ‚ÇΩ' : '0 ‚ÇΩ';

    //–ü—Ä–æ–≥—Ä–µ—Å—Å–±–∞—Ä
    const routesProgress = document.getElementById('routesProgress');
    const routesProgressLabel = document.getElementById('routesProgressLabel');

    const current = parseFloat(data.half_routes) || 0;
    const max = 16;
    let percent = (current / max) * 100;
    if (percent > 100) percent = 100;

    routesProgress.style.width = percent + '%';
    routesProgressLabel.textContent = `${formatNumber(current)} / ${max}`;

    if (current > max) {
      routesProgress.classList.add('progress-over');
    } else {
      routesProgress.classList.remove('progress-over');
    }

  } catch (error) {
    totalRoutes.textContent = '–û—à–∏–±–∫–∞';
    totalPassengers.textContent = '–û—à–∏–±–∫–∞';
    periodRoutes.textContent = '–û—à–∏–±–∫–∞';
    periodPassengers.textContent = '–û—à–∏–±–∫–∞';
    salary.textContent = '–û—à–∏–±–∫–∞';
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
  }
}


    function logout() {
      localStorage.removeItem('userLogin');
      document.cookie = "userLogin=; path=/; domain=.rotorbus.ru; expires=Thu, 01 Jan 1970 00:00:00 GMT";
      window.location.href = "https://auth.rotorbus.ru/";
    }

    window.addEventListener('DOMContentLoaded', loadDashboard);

    
  </script>
</body>

</html>