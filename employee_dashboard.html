<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1"> -->
  <title>–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</title>
  <link rel="stylesheet" href="style_db.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="icon.png">

  <script src="usermenu.js"></script> 
</head>

<body>

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="sidebar" id="sidebar"> 
    <div class="sidebar-header">
        <span class="logo">–†–û–¢–û–†</span>
    </div>

    <ul class="sidebar-menu">
        <li><a href="employee_dashboard.html"><i class="fas fa-user"></i><span>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span></a></li>
        <li><a href="employees.html"><i class="fas fa-users"></i><span>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span></a></li>
        <li><a href="routes.html"><i class="fas fa-route"></i><span>–ú–∞—Ä—à—Ä—É—Ç—ã</span></a></li>
        <li><a href="vehicles.html"><i class="fas fa-truck"></i><span>–°–ø–∏—Å–æ–∫ –ü–°</span></a></li>
        <li><a href="shift_report.html"><i class="fas fa-file"></i><span>–û—Ç—á–µ—Ç</span></a></li>
        <li><a href="charter.html"><i class="fas fa-book"></i><span>–£—Å—Ç–∞–≤</span></a></li>
        <li><a href="plan.html"><i class="fas fa-calendar"></i><span>–ü–ª–∞–Ω</span></a></li>
        <li><a href="t.html"><i class="fas fa-check"></i><span>–¢–µ—Å—Ç—ã</span></a></li>
        <li><a href="binds.html"><i class="fas fa-keyboard"></i><span>–ë–∏–Ω–¥—ã –∏ —Ç–∞–±–ª–∏—á–∫–∏</span></a></li>
    </ul>

    <div class="user-menu" id="userMenu">

      <div class="user-menu-item" id="nyBtn">
      <i class="fas fa-snowflake"></i>
      <span>–ù–ì –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
      </div>
      
    <div class="user-menu-item" id="themeBtn">
        <i class="fas fa-moon"></i>
        <span>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
    </div>

    <div class="user-menu-item" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i>
        <span>–í—ã–π—Ç–∏</span>
    </div>

    <div class="user-name-display">
        <i class="fas fa-user"></i>
        <span id="userName">user</span>
    </div> 
</div>
</div>
</div>


<div class="main-content">

  <div class="dashboard">
    <div class="tile">
  <h3>–ù–∏–∫–Ω–µ–π–º</h3>
  <p class="highlight" id="nickname">
    <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
  </p>

  <h3>–î–æ–ª–∂–Ω–æ—Å—Ç—å</h3>
  <p class="highlight" id="userRole">
    <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
  </p>
  <br>

  <button class="logout-btn" onclick="logout()">
    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
  </button>
</div>


<div class="tile">
  <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ–≥–æ</h3>
  <p>–ö—Ä—É–≥–æ—Ä–µ–π—Å–æ–≤:
    <span class="highlight" id="totalRoutes">
      <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
    </span>
  </p>
  <p>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤:
    <span class="highlight" id="totalPassengers">
      <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
    </span>
  </p>
</div>

<div class="tile">
  <h3>–¢–µ–∫—É—â–∏–π –ø–æ–ª—É–ø–µ—Ä–∏–æ–¥</h3>

  <p>–ö—Ä—É–≥–æ—Ä–µ–π—Å–æ–≤:
    <span class="highlight" id="periodRoutes">
      <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
    </span>
  </p>

  <div class="progress-container">
    <div class="progress-bar" id="routesProgress"></div>
    <span class="progress-label" id="routesProgressLabel">0 / 16</span>
  </div>

  <p>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–≤:
    <span class="highlight" id="periodPassengers">
      <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
    </span>
  </p>

  <p>–ó–∞—Ä–ø–ª–∞—Ç–∞:
    <span class="highlight" id="salary">
      <i class="fa-solid fa-spinner fa-spin loading-icon"></i>
    </span>
  </p>
</div>

    <div class="tile important">
      <p>–í–æ–¥–∏—Ç–µ–ª—å, –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–º–µ–Ω—ã –Ω–µ –∑–∞–±—ã–≤–∞–π —Å–¥–∞–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–Ω—ã–π –ª–∏—Å—Ç</p>
    </div>

  <div class="tile important">
  <p>–í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –ø–µ—Ä–≤—ã–π –ø–æ–ª—É–ø–µ—Ä–∏–æ–¥ –¥–µ–∫–∞–±—Ä—è</p>

  <a href="https://dashboard.rotorprov.ru/12h1" 
     target="_blank" 
     class="button">
    –û—Ç–∫—Ä—ã—Ç—å
  </a>
</div> 

  

  </div>
</div>
  <script>
    const pageAccess = null;
const API = "https://rotorbus.ru/api";
const COMPANY = "rotor";

/* =========================
   Helpers
========================= */
function getCookie(name) {
  const match = document.cookie.match(
    new RegExp("(^| )" + name + "=([^;]+)")
  );
  return match ? decodeURIComponent(match[2]) : null;
}

function formatNumber(v) {
  if (v === null || v === undefined) return "0";
  return Number(v).toLocaleString("ru-RU");
}

/* =========================
   Dashboard
========================= */
async function loadDashboard() {
  const login = getCookie("userLogin");
  if (!login) return;

  nickname.textContent = login;

  try {
    // ‚ö†Ô∏è –ë–ï–†–Å–ú –í–°–Æ –°–¢–ê–¢–ò–°–¢–ò–ö–£
    const res = await fetch(`${API}/statistics/${COMPANY}`);
    if (!res.ok) throw new Error("HTTP " + res.status);

    const data = await res.json();
    if (data.status !== "ok") throw new Error("API error");

    // üîé –ò–©–ï–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
    const stats = data.statistics.find(
      s => s.user_name === login
    );

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –±–µ–∑ –æ—Ç—á—ë—Ç–æ–≤
    const s = stats || {
      post: "‚Äî",
      total_round_trips: 0,
      period_round_trips: 0,
      total_passengers: 0,
      period_passengers: 0,
      period_salary: 0
    };

    /* ===== UI ===== */
    userRole.textContent = s.post || "‚Äî";

    totalRoutes.textContent = formatNumber(s.total_round_trips);
    totalPassengers.textContent = formatNumber(s.total_passengers);

    periodRoutes.textContent = formatNumber(s.period_round_trips);
    periodPassengers.textContent = formatNumber(s.period_passengers);
    salary.textContent = formatNumber(s.period_salary) + " ‚ÇΩ";

    /* ===== Progress ===== */
    const max = 16;
    const current = Number(s.period_round_trips) || 0;
    let percent = (current / max) * 100;
    if (percent > 100) percent = 100;

    routesProgress.style.width = percent + "%";
    routesProgressLabel.textContent = `${current} / ${max}`;

    if (current > max) {
      routesProgress.classList.add("progress-over");
    } else {
      routesProgress.classList.remove("progress-over");
    }

  } catch (e) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
  }
}

window.addEventListener("DOMContentLoaded", loadDashboard);
</script>


</body>
<script src="sidebar.js"></script>
<script src="checkauth.js"></script>
</html>