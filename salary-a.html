<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style_db.css">
  <link rel="stylesheet" href="style_a.css">
</head>
<body>

<div class="main-content">
<div class="container">

<h1>üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã</h1>

<div class="table-card">
  <div class="form-inline">
    <input id="userName" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
    <button class="actions-btn" onclick="loadStats()">–ü–æ–∫–∞–∑–∞—Ç—å</button>
  </div>
</div>

<div class="table-card" id="stats" style="display:none;">
  <p><b>–û–±—â–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞:</b> <span id="total_salary"></span></p>
  <p><b>–ó–∞ –ø–µ—Ä–∏–æ–¥:</b> <span id="period_salary"></span></p>
  <p><b>–†–µ–π—Å—ã –≤—Å–µ–≥–æ:</b> <span id="total_round_trips"></span></p>
  <p><b>–†–µ–π—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥:</b> <span id="period_round_trips"></span></p>
  <p><b>–ü–∞—Å—Å–∞–∂–∏—Ä—ã –≤—Å–µ–≥–æ:</b> <span id="total_passengers"></span></p>
  <p><b>–ü–∞—Å—Å–∞–∂–∏—Ä—ã –∑–∞ –ø–µ—Ä–∏–æ–¥:</b> <span id="period_passengers"></span></p>
</div>

</div>
</div>

<script>
const API = 'https://rotorbus.ru/api';
const COMPANY = 'rotor';

async function loadStats() {
  const res = await fetch(`${API}/get_user_statistics/${COMPANY}`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ user_name: userName.value })
  });

  const d = await res.json();
  if (d.status !== 'ok') return alert(d.message);

  Object.keys(d).forEach(k => {
    if (document.getElementById(k)) {
      document.getElementById(k).textContent = d[k];
    }
  });

  document.getElementById('stats').style.display = 'block';
}
</script>
</body>
</html>
